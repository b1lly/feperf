var fep=function(a,b,c){return{logging:!1,provide:function(b){var c=b.split("."),d=a;for(var e=0;e<c.length;e++)d[c[e]]=d[c[e]]||{},d=d[c[e]]},log:function(b,c,d){if(this.logging){var e=arguments.callee.caller.name||"anonymous";c=c||!1,d=d||!1,"object"==typeof a.console&&"function"==typeof a.console.log&&(c?b=e+": "+b:b,d?a.console.warn(b):a.console.log(b))}},warn:function(a,b){this.log(a,b,!0)},walkTheDom:function(a,b){"function"==typeof b&&b(a),a=a.firstChild;while(a)this.walkTheDom(a,b),a=a.nextSibling},size:function(a){var b=0;for(var c in a)a.hasOwnProperty(c)&&b++;return b},setCaretPosition:function(a,b,c){var d=a.get(0);c=c||0,d&&(d.createTextRange?setTimeout(function(){var a=d.createTextRange();a.move("character",b),a.moveEnd("character",c),a.select(),d.focus()},0):d.setSelectionRange&&(d.setSelectionRange(b,b+c),setTimeout(function(){a.focus()},0)))},getCaretPosition:function(a){var c=a.get(0);if(c.selectionEnd)return c.selectionEnd;if(c.createTextRange){var d=b.selection.createRange();var e=c.value.length;var f=c.createTextRange();return f.moveToBookmark(d.getBookmark()),-f.moveStart("character",-e)}return 0},extend:function(){var a,b,d,e,f,g,h=arguments[0]||{},i=1,j=arguments.length,k=!1;for("boolean"==typeof h&&(k=h,h=arguments[i]||{},i++),"object"!=typeof h&&"function"!=typeof h&&(h={});j>i;i++)if(null!=(a=arguments[i]))for(b in a)d=h[b],e=a[b],h!==e&&(k&&e&&(fep.isPlainObject(e)||(f=fep.isArray(e)))?(f?(f=!1,g=d&&fep.isArray(d)?d:[]):g=d&&fep.isPlainObject(d)?d:{},h[b]=fep.extend(k,g,e)):e!==c&&(h[b]=e));return h},isArray:Array.isArray,isPlainObject:function(a){return"object"!=typeof a||a.nodeType?!1:!0},scrollTo:function(a,b,d){typeof a!==c&&(b=b||1e3,d=d||0,$("html, body").animate({scrollTop:a.offset().top-d},b))}}}(window,document);fep.provide("fep.debug"),function(a,b,c,d){var e=a.debug;return e.pageStats={},e.eventListeners={count:0,listeners:[]},e.cssRules={},e.init=function(){this.profileAllJs(),this.trackEventListeners();var b={network:this.profileNetwork(),parsing:this.profilePageLoad(),events:this.eventListeners};return e.pageStats=a.extend(e.pageStats,b),e.pageStats},e.hasPerformanceSupport=function(){return"object"==typeof b.performance},e.hasTimingSupport=function(){return e.hasPerformanceSupport()&&"object"==typeof b.performance.timing},e.hasNavigationSupport=function(){return e.hasPerformanceSupport()&&"object"==typeof b.performance.navigation},e.appendMilliseconds=function(b){if("object"==typeof b)for(var c in b)b[c]=b[c]>=0?Math.round(100*b[c])/100+"ms":d;else a.warn("Sorry, you need to pass in an object!");return b},e.getResourcesByInitiator=function(){var c=[],d={};if(e.hasPerformanceSupport()&&"function"==typeof b.performance.getEntries){c=b.performance.getEntries();for(var f=0;f<c.length;f++)d.hasOwnProperty(c[f].initiatorType)||(d[c[f].initiatorType]=[]),d[c[f].initiatorType].push(c[f])}else a.warn("Your browser doesn't support this feature!");return d={resourcesByInitiator:d,latencySumByInitiator:e.getLatencySumByInitiator(d),resourceCountByInitiator:e.getResourceCountByInitiator(d)}},e.getLatencySumByInitiator=function(a){var b={};for(var c in a){b[c]=0;for(var d in a[c])b[c]+=a[c][d].duration}return b.totalLatency=e.getResourceLatencyTotal(b),b=e.appendMilliseconds(b)},e.getResourceLatencyTotal=function(a){var b=0;for(var c in a)b+=parseFloat(a[c]);return b},e.getResourceCountByInitiator=function(a){var b={};for(var c in a)b[c]=a[c].length;return b},e.trackEventListeners=function(){var a=Node.prototype.addEventListener;Node.prototype.addEventListener=function(){e.eventListeners.count++,e.eventListeners.listeners.push({type:arguments[0],node:arguments[1].elem}),a.apply(this,arguments)};var b=Node.prototype.removeEventListener;Node.prototype.removeEventListener=function(){e.eventListeners.count--}},e.profileAllJs=function(){a.log("hook into js call stack and future calls -- to profile performance")},e.profileJs=function(b){var c=(new Date).getMilliseconds();return"function"!=typeof b?(a.warn("Please provide a callback function!"),!1):(b.call(this),(new Date).getMilliseconds()-c)},e.profileNetwork=function(){var c,d={},f={};return e.hasTimingSupport()?(c=b.performance.timing,f={unload:c.unloadEventEnd-c.navigationStart,redirect:c.redirectEnd-c.redirectStart,domainLookup:c.domainLookupEnd-c.domainLookupStart,tcpConnection:c.connectEnd-c.connectStart,request:c.responseStart-c.requestStart,response:c.responseEnd-c.responseStart,totalLatency:c.responseEnd-c.fetchStart},f=e.appendMilliseconds(f),d=e.getResourcesByInitiator()):a.warn("Browser not supported yet!"),{timing:c,pageLoad:f,resources:d}},e.profilePageLoad=function(){var c,d=0;return parsingLatency={},e.hasTimingSupport()?(c=b.performance.timing,e.profiler&&(d=a.debug.profiler.get("jsLoad").getTime()),parsingLatency={totalLatency:c.loadEventEnd-c.responseEnd+d,domParsing:c.domInteractive-c.domLoading,resourceParsing:c.domComplete-c.domInteractive,jsParsing:d}):a.warn("Browser not supported yet!"),parsingLatency=e.appendMilliseconds(parsingLatency),{timing:c,parsingLatency:parsingLatency}},e}(fep,window,document),fep.provide("fep.debug.profiler"),function(a,b,c,d){var e=a.debug.profiler;e.profilers_={};var f=function(a){this.name=a,this.startTime=0,this.endTime=0,this.timeElapsed=0};f.prototype.start=function(){this.startTime=new Date,a.log("started profiling: "+this.name)},f.prototype.stop=function(){this.endTime=new Date,this.timeElapsed=this.endTime-this.startTime,a.log("stopped profiling: "+this.name+" ("+this.timeElapsed+")")},f.prototype.getTime=function(){return this.timeElapsed},e.create=function(b){if("string"!=typeof b)return a.log("please provide a profiler name.");var c=new f(b);return e.profilers_[b]=c,a.log(e.profilers_),c},e.get=function(a){return"string"==typeof a?e.profilers_[a]||new f("anonymous"):void 0}}(fep,window,document),fep.provide("fep.debug.toolbar"),function(a,b,c,d){var e=a.debug.toolbar,f={};var g={networkLatency:{totalLatency:500,redirect:10,domainLookup:50,tcpConnection:10,request:300,response:170},parsingLatency:{totalLatency:60,domParsing:300,resourceParsing:100},resourceLatency:{link:100,script:100,css:300,img:500,xmlhttprequest:100}};var h=d,i=d;return e.init=function(){return e.jQuerySupport()?"function"!=typeof a.debug.init?(a.log("This toolbar requires the fep.debug module!"),!1):(f=a.debug.init(),h=$(c),i=h.find("#fep-debug-toolbar"),this.setNetworkLatency(f.network.pageLoad),this.setResourceLatency(f.network.resources),this.setParsingLatency(f.parsing.parsingLatency),this.bindDetails(),this.linkMetricsToBar(),this.bindClose(),i.fadeIn(),h.find("body").css("margin-top",i.outerHeight(!0)),void 0):(a.log("jQuery is required in order to use this!"),!1)},e.jQuerySupport=function(){return"function"==typeof jQuery},e.setNetworkLatency=function(a){var b={totalLatency:i.find(".network-latency"),redirect:i.find(".redirect"),domainLookup:i.find(".domain-lookup"),tcpConnection:i.find(".tcp-connection"),request:i.find(".request"),response:i.find(".response"),unload:i.find("unload")};e.updateDom(b,a,"networkLatency")},e.setParsingLatency=function(a){var b={totalLatency:i.find(".parsing-latency"),domParsing:i.find(".dom-parsing"),resourceParsing:i.find(".resource-parsing"),jsParsing:i.find(".js-parsing")};e.updateDom(b,a,"parsingLatency")},e.setResourceLatency=function(a){var b={totalLatency:i.find(".resource-latency"),link:i.find(".resource-link"),script:i.find(".resource-script"),css:i.find(".resource-css"),img:i.find(".resource-img"),xmlhttprequest:i.find(".resource-xhr")};e.updateDom(b,a.latencySumByInitiator,"resourceLatency");for(var c in a.resourceCountByInitiator)b[c]&&b[c].first().removeClass("red green yellow").html(a.resourceCountByInitiator[c])},e.updateDom=function(a,b,c){var d,e,f;for(var h in b)e=parseFloat(b[h]),f=g[c][h],d=e>f?"red":f/2>e?"green":"yellow",a[h]&&a[h].removeClass("red yellow green").html(b[h]).addClass(d)},e.bindDetails=function(){i.find("#metrics-wrapper li").hover(function(){$(this).find(".metric-details").stop().fadeToggle("fast")})},e.linkMetricsToBar=function(){$("#fep-debug-toolbar .bar span, #fep-debug-toolbar .metric-details li").hover(function(a){var b=$(this),c=b.parents("li");b.parents(".bar").length>0?c.find(".metric-details li:eq("+b.index()+")").toggleClass("hover"):c.find(".bar span:eq("+b.index()+")").toggleClass("hover")})},e.bindClose=function(){i.find(".js-toggle-close").on("click",function(){i.hide(),h.find("body").css("margin-top","auto")})},e}(fep,window,document);